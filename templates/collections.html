<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collections â€” Social Saver</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --primary:#3b82f6;--primary-light:#fb7185;
            --primary-dark:#be123c;--secondary:#10b981;
            --dark:#0a0a0a;--card:#171717;
            --border:#262626;--text:#fafafa;--text-muted:#a3a3a3;
        }
        body{font-family:'DM Sans',system-ui,-apple-system,sans-serif;background:var(--dark);color:var(--text);line-height:1.6;min-height:100vh}
        
        /* Navbar */
        .navbar{background:var(--card);padding:1.25rem 2rem;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100}
        .navbar-brand{display:flex;align-items:center;gap:.75rem;font-size:1.5rem;font-weight:800;font-family:'Syne',sans-serif;text-decoration:none;color:var(--text)}
        .navbar-brand span{color:var(--primary)}
        .navbar-nav{display:flex;gap:2rem;list-style:none}
        .navbar-nav a{color:var(--text-muted);text-decoration:none;transition:color .3s;font-weight:500;font-size:.95rem}
        .navbar-nav a:hover,.navbar-nav a.active{color:var(--primary)}
        
        /* Container */
        .container{max-width:1400px;margin:0 auto;padding:2.5rem}
        
        /* Hero */
        .hero{margin-bottom:2.5rem}
        .hero h1{font-size:2.5rem;font-weight:800;font-family:'Syne',sans-serif;margin-bottom:.5rem}
        .hero h1 em{color:var(--primary);font-style:normal}
        .hero p{color:var(--text-muted);font-size:1.1rem}
        
        /* Collections Bar */
        .collections-bar{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:1.25rem;margin-bottom:2rem;display:flex;flex-wrap:wrap;gap:.75rem;align-items:center}
        .col-chip{display:inline-flex;align-items:center;gap:.4rem;padding:.5rem 1rem;border-radius:20px;background:var(--dark);border:1px solid var(--border);color:var(--text-muted);font-size:.85rem;font-weight:600;text-decoration:none;transition:all .2s}
        .col-chip:hover,.col-chip.active{background:rgba(59,130,246,.12);border-color:var(--primary);color:var(--primary)}
        .col-chip-wrap{display:inline-flex;align-items:center;gap:.2rem}
        .col-delete-btn{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.2);color:#ef4444;border-radius:50%;width:20px;height:20px;font-size:.7rem;cursor:pointer;line-height:1;padding:0;display:inline-flex;align-items:center;justify-content:center}
        .col-delete-btn:hover{background:#ef4444;color:#fff}
        .col-input{padding:.5rem .85rem;border-radius:8px;border:1px solid var(--border);background:var(--dark);color:var(--text);font-size:.85rem;width:160px}
        .col-input:focus{outline:none;border-color:var(--primary)}
        .col-add-btn{background:var(--primary);color:#fff;border:none;border-radius:8px;padding:.5rem 1rem;font-size:.8rem;font-weight:700;cursor:pointer}
        .col-add-btn:hover{background:var(--primary-dark)}
        
        /* Stats */
        .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1.25rem;margin-bottom:2.5rem}
        .stat{background:var(--card);border-radius:14px;padding:1.5rem;border:1px solid var(--border);transition:all .3s}
        .stat:hover{transform:translateY(-3px);border-color:var(--primary)}
        .stat-num{font-size:2.5rem;font-weight:800;font-family:'Syne',sans-serif;margin-bottom:.25rem}
        .stat-num.total{color:var(--primary)}
        .stat-lbl{color:var(--text-muted);font-size:.95rem}
        
        /* Grid */
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem}
        
        /* Card */
        .card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;transition:all .3s;display:flex;flex-direction:column}
        .card:hover{border-color:var(--primary);transform:translateY(-3px)}
        .card-media{position:relative;height:160px;overflow:hidden;background:linear-gradient(135deg,#1f2937,#111)}
        .card-media img{width:100%;height:100%;object-fit:cover}
        .card-placeholder{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:3rem;color:rgba(255,255,255,.3)}
        .card-placeholder.instagram{background:linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888)}
        .card-placeholder.twitter{background:linear-gradient(45deg,#1da1f2,#0d8ecf)}
        .card-placeholder.youtube{background:linear-gradient(45deg,#ff0000,#cc0000)}
        .card-placeholder.tiktok{background:linear-gradient(45deg,#00f2ea,#ff0050)}
        .card-body{padding:1.25rem;flex:1;display:flex;flex-direction:column;gap:.5rem}
        .card-platform{display:inline-block;padding:.2rem .65rem;border-radius:20px;font-size:.65rem;font-weight:700;text-transform:uppercase}
        .card-platform.instagram{background:rgba(225,48,108,.15);color:#e1306c}
        .card-platform.twitter{background:rgba(29,161,242,.15);color:#1da1f2}
        .card-platform.youtube{background:rgba(255,0,0,.15);color:#ff4444}
        .card-platform.tiktok{background:rgba(0,242,234,.15);color:#00f2ea}
        .card-platform.reddit{background:rgba(255,69,0,.15);color:#ff4500}
        .card-platform.blog{background:rgba(16,185,129,.15);color:#10b981}
        .card-platform.linkedin{background:rgba(0,119,181,.15);color:#0077b5}
        .card-platform.pinterest{background:rgba(230,0,35,.15);color:#e60023}
        .card-title{font-size:1rem;font-weight:600;line-height:1.4}
        .card-title a{color:inherit;text-decoration:none}
        .card-title a:hover{color:var(--primary)}
        .card-summary{font-size:.85rem;color:var(--text-muted);line-height:1.5;flex:1}
        .card-footer{display:flex;align-items:center;justify-content:space-between;padding-top:.75rem;border-top:1px solid var(--border);margin-top:auto}
        
        /* Assign Select */
        .assign-select{background:var(--dark);border:1px solid var(--border);border-radius:8px;padding:.4rem .6rem;color:var(--text-muted);font-size:.75rem;cursor:pointer;outline:none;min-width:140px}
        .assign-select:hover,.assign-select:focus{border-color:var(--primary);color:var(--text)}
        
        /* Empty */
        .empty{grid-column:1/-1;text-align:center;padding:4rem 2rem}
        .empty i{font-size:4rem;margin-bottom:1rem;display:block;opacity:.2}
        .empty h3{font-family:'Syne',sans-serif;font-size:1.5rem;margin-bottom:.5rem;color:var(--text)}
        
        /* Toast */
        .toast{position:fixed;bottom:1.5rem;right:1.5rem;z-index:9999;background:var(--secondary);color:#fff;padding:.75rem 1.5rem;border-radius:10px;font-size:.9rem;font-weight:600;opacity:0;transform:translateY(10px);transition:all .25s;pointer-events:none}
        .toast.show{opacity:1;transform:translateY(0)}
        
        /* Back Link */
        .back-link{color:var(--text-muted);text-decoration:none;font-size:.9rem;display:inline-flex;align-items:center;gap:.5rem;margin-bottom:1.5rem}
        .back-link:hover{color:var(--primary)}
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="{{ url_for('dashboard') }}" class="navbar-brand"><i class="fas fa-bookmark"></i> Social<span>Saver</span></a>
        <ul class="navbar-nav">
            <li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
            <li><a href="{{ url_for('discover') }}">Discover</a></li>
            <li><a href="{{ url_for('stats_page') }}">Stats</a></li>
            <li><a href="{{ url_for('collections_page') }}" class="active">Collections</a></li>
        </ul>
    </nav>
    
    <div class="container">
        <a href="{{ url_for('dashboard') }}" class="back-link"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
        
        <div class="hero">
            <h1><i class="fas fa-folder-open" style="color:var(--primary)"></i> <em>Collections</em></h1>
            <p>Organize your saved content into folders</p>
        </div>
        
        <!-- Collections Bar -->
        <div class="collections-bar">
            <a href="{{ url_for('collections_page') }}" class="col-chip {% if not selected_collection %}active{% endif %}">
                <i class="fas fa-th-large"></i> All
            </a>
            {% for col in collections %}
            <div class="col-chip-wrap">
                <a href="{{ url_for('collections_page', collection=col) }}" class="col-chip {% if selected_collection==col %}active{% endif %}">
                    <i class="fas fa-folder"></i> {{ col }}
                </a>
                <form method="POST" action="{{ url_for('delete_collection_route') }}" style="display:inline">
                    <input type="hidden" name="name" value="{{ col }}">
                    <button type="submit" class="col-delete-btn" title="Delete folder" onclick="return confirm('Delete folder \"{{ col }}\"? Items will not be deleted.')">Ã—</button>
                </form>
            </div>
            {% endfor %}
            
            <form method="POST" action="{{ url_for('create_collection_route') }}" style="display:inline-flex;gap:.5rem;align-items:center">
                <input name="name" placeholder="New folder..." class="col-input" maxlength="40">
                <button type="submit" class="col-add-btn">+ Add</button>
            </form>
            
            {% if not collections %}
            <span style="color:var(--text-muted);font-size:.85rem;margin-left:.5rem">No folders yet â€” create one!</span>
            {% endif %}
        </div>
        
        <!-- Stats -->
        <div class="stats">
            <div class="stat">
                <div class="stat-num total">{{ all_items|length }}</div>
                <div class="stat-lbl">Total Saved</div>
            </div>
            <div class="stat">
                <div class="stat-num">{{ collections|length }}</div>
                <div class="stat-lbl">Collections</div>
            </div>
            {% if selected_collection %}
            {% set selected_count = all_items | selectattr('collection', 'equalto', selected_collection) | list | length %}
            <div class="stat">
                <div class="stat-num">{{ selected_count }}</div>
                <div class="stat-lbl">In "{{ selected_collection }}"</div>
            </div>
            {% endif %}
        </div>
        
        <!-- Content Grid -->
        <div class="grid">
            {% if content_list %}
                {% for item in content_list %}
                <div class="card" data-id="{{ item.id }}">
                    <div class="card-media">
                        {% if item.image_url %}
                        <img src="{{ item.image_url }}" alt="" onerror="this.parentElement.innerHTML='<div class=\\'card-placeholder {{ item.platform }}\\'><i class=\\'fab fa-{{ item.platform }}\\'></i></div>'">
                        {% else %}
                        <div class="card-placeholder {{ item.platform }}">
                            {% if item.platform == 'youtube' %}<i class="fab fa-youtube"></i>
                            {% elif item.platform == 'instagram' %}<i class="fab fa-instagram"></i>
                            {% elif item.platform == 'twitter' %}<i class="fab fa-twitter"></i>
                            {% elif item.platform == 'tiktok' %}<i class="fab fa-tiktok"></i>
                            {% elif item.platform == 'reddit' %}<i class="fab fa-reddit"></i>
                            {% elif item.platform == 'linkedin' %}<i class="fab fa-linkedin"></i>
                            {% else %}<i class="fas fa-link"></i>{% endif %}
                        </div>
                        {% endif %}
                    </div>
                    <div class="card-body">
                        <span class="card-platform {{ item.platform }}">{{ item.platform }}</span>
                        <div class="card-title">
                            <a href="{{ url_for('content_detail', content_id=item.id) }}">{{ item.title or 'Untitled' }}</a>
                        </div>
                        {% if item.summary %}<div class="card-summary">{{ item.summary }}</div>{% endif %}
                        <div class="card-footer">
                            <select class="assign-select" onchange="assignToFolder({{ item.id }}, this)">
                                <option value=""><i class="fas fa-folder"></i> {{ item.collection if item.collection else 'Add to folder...' }}</option>
                                {% if item.collection %}<option value="">âœ– Remove</option>{% endif %}
                                {% for col in collections %}<option value="{{ col }}" {% if item.collection == col %}selected{% endif %}>ðŸ”– {{ col }}</option>{% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty">
                    <i class="fas fa-folder-open"></i>
                    <h3>{% if selected_collection %}This folder is empty{% else %}No saves yet{% endif %}</h3>
                    <p style="color:var(--text-muted);margin-top:.5rem">
                        {% if selected_collection %}Go to <a href="{{ url_for('collections_page') }}" style="color:var(--primary)">All Saves</a> and assign posts to this folder.{% else %}Save some links via WhatsApp first!{% endif %}
                    </p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>
    
    <script>
    function showToast(msg, color) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.style.background = color || '#10b981';
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2500);
    }
    
    function assignToFolder(id, selectEl) {
        const value = selectEl.value;
        const form = new FormData();
        form.append('content_id', id);
        form.append('collection', value);
        
        fetch('{{ url_for("assign_collection_route") }}', { method: 'POST', body: form })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    if (value) showToast('Added to "' + value + '" ðŸ”–');
                    else showToast('Removed from folder', '#6b7a90');
                    setTimeout(() => location.reload(), 1000);
                }
            });
    }
    </script>
</body>
</html>

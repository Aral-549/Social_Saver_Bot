<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discover — Social Saver Bot</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --primary:#3b82f6;--primary-light:#fb7185;
            --primary-dark:#be123c;--secondary:#10b981;
            --dark:#0a0a0a;--card:#171717;
            --border:#262626;--text:#fafafa;--text-muted:#a3a3a3;
        }
        body{font-family:'DM Sans',system-ui,-apple-system,sans-serif;background:var(--dark);color:var(--text);line-height:1.6;min-height:100vh}
        
        /* Navbar */
        .navbar{background:var(--card);padding:1.25rem 2rem;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100}
        .navbar-brand{display:flex;align-items:center;gap:.75rem;font-size:1.5rem;font-weight:800;font-family:'Syne',sans-serif;text-decoration:none;color:var(--text)}
        .navbar-brand span{color:var(--primary)}
        .navbar-nav{display:flex;gap:2rem;list-style:none}
        .navbar-nav a{color:var(--text-muted);text-decoration:none;transition:color .3s;font-weight:500;font-size:.95rem}
        .navbar-nav a:hover,.navbar-nav a.active{color:var(--primary)}
        
        /* Container */
        .container{max-width:1400px;margin:0 auto;padding:2.5rem}
        
        /* Header */
        .header{margin-bottom:2.5rem}
        .header h1{font-size:3rem;font-weight:800;font-family:'Syne',sans-serif;margin-bottom:.5rem}
        .header h1 em{color:var(--primary);font-style:normal}
        .header p{color:var(--text-muted);font-size:1.15rem}
        
        /* Tabs */
        .tabs{display:flex;gap:.5rem;margin-bottom:2rem;border-bottom:1px solid var(--border);padding-bottom:1.25rem;overflow-x:auto}
        .tab{padding:.85rem 1.75rem;border-radius:10px;font-weight:600;cursor:pointer;white-space:nowrap;transition:all .3s;background:none;border:none;color:var(--text-muted);font-family:inherit;font-size:.95rem}
        .tab:hover{background:var(--card);color:var(--text)}
        .tab.active{background:var(--primary);color:#fff}
        
        /* Filters */
        .filters{display:flex;gap:1rem;flex-wrap:wrap;align-items:center;margin-bottom:2rem}
        .search{position:relative;flex:1;min-width:260px}
        .search input{width:100%;padding:1rem 1rem 1rem 3rem;background:var(--card);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:1rem;font-family:inherit}
        .search i{position:absolute;left:1.1rem;top:50%;transform:translateY(-50%);color:var(--text-muted)}
        .select{padding:1rem 1.25rem;background:var(--card);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:1rem;cursor:pointer;font-family:inherit}
        .select:focus{outline:none;border-color:var(--primary)}
        .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.85rem 1.5rem;border:none;border-radius:10px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .3s;text-decoration:none;font-family:inherit}
        .btn-primary{background:var(--primary);color:#fff}
        .btn-primary:hover{background:var(--primary-dark)}
        .btn-secondary{background:var(--card);color:var(--text);border:1px solid var(--border)}
        .btn-secondary:hover{border-color:var(--primary)}
        
        /* Section */
        .section{margin-bottom:2.5rem}
        .section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.25rem}
        .section-title{font-size:1.5rem;font-weight:700;font-family:'Syne',sans-serif}
        
        /* Grid */
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:1.5rem}
        
        /* Card */
        .card{background:var(--card);border-radius:14px;overflow:hidden;border:1px solid var(--border);transition:all .3s;text-decoration:none;color:inherit;display:flex;flex-direction:column}
        .card:hover{transform:translateY(-5px);border-color:var(--primary);box-shadow:0 15px40px rgba(0,0,0,.4)}
        
        /* Card Image */
        .card-media{position:relative;overflow:hidden}
        .card-img{width:100%;height:220px;object-fit:cover;transition:transform .5s;display:block}
        .card:hover .card-img{transform:scale(1.08)}
        
        /* Platform Placeholders */
        .card-placeholder{width:100%;height:220px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.75rem;font-size:3rem;color:#fff}
        .card-placeholder.youtube{background:linear-gradient(135deg,#dc2626,#991b1b)}
        .card-placeholder.instagram{background:linear-gradient(135deg,#f59e0b,#ec4899,#8b5cf6)}
        .card-placeholder.twitter{background:linear-gradient(135deg,#171717,#27272a)}
        .card-placeholder.tiktok{background:linear-gradient(135deg,#010101,#ff0050,#00f2ea)}
        .card-placeholder.facebook{background:linear-gradient(135deg,#1877f2,#0d65d9)}
        .card-placeholder.linkedin{background:linear-gradient(135deg,#0077b5,#005885)}
        .card-placeholder.reddit{background:linear-gradient(135deg,#ff4500,#ff6b3d)}
        .card-placeholder.pinterest{background:linear-gradient(135deg,#e60023,#ff4757)}
        .card-placeholder.blog{background:linear-gradient(135deg,#10b981,#34d399)}
        
        .card-placeholder span{font-size:.9rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;opacity:.85}
        
        .badge{position:absolute;bottom:.75rem;left:.75rem;display:inline-flex;padding:.35rem .85rem;border-radius:50px;font-size:.75rem;font-weight:700;text-transform:uppercase;background:rgba(0,0,0,.8);color:#fff;border:1px solid rgba(255,255,255,.1)}
        
        /* Card Body */
        .card-body{padding:1.5rem;flex:1;display:flex;flex-direction:column}
        .card-title{font-size:1.15rem;font-weight:700;margin-bottom:.5rem;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;font-family:'Syne',sans-serif}
        .card-title a{color:var(--text);text-decoration:none}
        .card-title a:hover{color:var(--primary)}
        .card-caption{color:var(--text-muted);font-size:.95rem;margin-bottom:1rem;line-height:1.5;flex:1;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        
        .card-category{display:inline-block;padding:.35rem .9rem;background:var(--dark);border-radius:50px;font-size:.8rem;color:var(--secondary);margin-bottom:.75rem;border:1px solid var(--border)}
        
        .card-footer{display:flex;justify-content:space-between;align-items:center;padding-top:1rem;border-top:1px solid var(--border);font-size:.85rem;color:var(--text-muted)}
        
        /* Empty */
        .empty{text-align:center;padding:5rem 2rem}
        .empty-icon{width:90px;height:90px;margin:0 auto 1.5rem;background:var(--card);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2.25rem;color:var(--primary);border:1px solid var(--border)}
        .empty h2{font-size:1.75rem;margin-bottom:.5rem;font-family:'Syne',sans-serif}
        .empty p{color:var(--text-muted);font-size:1.05rem}
        
        /* Pagination */
        .pagination{display:flex;justify-content:center;gap:.5rem;margin-top:2.5rem;flex-wrap:wrap}
        .pagination a,.pagination span{padding:.6rem 1rem;border-radius:8px;border:1px solid var(--border);color:var(--text-muted);text-decoration:none;transition:all .2s;font-size:.95rem}
        .pagination a:hover{border-color:var(--primary);color:var(--primary)}
        .pagination .current{background:var(--primary);border-color:var(--primary);color:#fff}
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="{{ url_for('dashboard') }}" class="navbar-brand"><i class="fas fa-bookmark"></i> Social<span>Saver</span></a>
        <ul class="navbar-nav">
            <li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
            <li><a href="{{ url_for('discover') }}" class="active">Discover</a></li>
            <li><a href="{{ url_for('stats_page') }}">Stats</a></li>
            <li><a href="{{ url_for('collections_page') }}">Collections</a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="header">
            <h1>Discover <em>more</em></h1>
            <p>Explore content from your saved collection</p>
        </div>

        <!-- Quick Filters -->
        <div class="tabs">
            <button class="tab {% if not selected_platform and not selected_category %}active{% endif %}" onclick="filterAll()">
                <i class="fas fa-border-all"></i> All
            </button>
            <button class="tab {% if selected_platform=='youtube' %}active{% endif %}" onclick="filterPlatform('youtube')">
                <i class="fab fa-youtube"></i> YouTube
            </button>
            <button class="tab {% if selected_platform=='instagram' %}active{% endif %}" onclick="filterPlatform('instagram')">
                <i class="fab fa-instagram"></i> Instagram
            </button>
            <button class="tab {% if selected_platform=='twitter' %}active{% endif %}" onclick="filterPlatform('twitter')">
                <i class="fab fa-twitter"></i> Twitter
            </button>
            <button class="tab {% if selected_platform=='tiktok' %}active{% endif %}" onclick="filterPlatform('tiktok')">
                <i class="fab fa-tiktok"></i> TikTok
            </button>
            <button class="tab {% if selected_platform=='reddit' %}active{% endif %}" onclick="filterPlatform('reddit')">
                <i class="fab fa-reddit"></i> Reddit
            </button>
            <button class="tab {% if selected_platform=='blog' %}active{% endif %}" onclick="filterPlatform('blog')">
                <i class="fas fa-globe"></i> Articles
            </button>
        </div>

        <form method="GET" action="{{ url_for('discover') }}" class="filters">
            <div class="search"><i class="fas fa-search"></i><input type="text" name="q" placeholder="Search content…" value="{{ search_query or '' }}"></div>
            <select name="platform" class="select">
                <option value="">All platforms</option>
                {% for p in platforms %}
                <option value="{{ p }}" {% if selected_platform==p %}selected{% endif %}>{{ p|title }}</option>
                {% endfor %}
            </select>
            <select name="category" class="select">
                <option value="">All categories</option>
                {% for c in categories %}
                <option value="{{ c }}" {% if selected_category==c %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary"><i class="fas fa-filter"></i> Filter</button>
            {% if selected_platform or selected_category or search_query %}
            <a href="{{ url_for('discover') }}" class="btn btn-secondary"><i class="fas fa-times"></i> Clear</a>
            {% endif %}
        </form>

        {% if content %}
        <div class="grid">
            {% for item in content %}
            <a href="{{ url_for('content_detail', content_id=item.id) }}" class="card" id="card-{{ item.id }}">
                <div class="card-media">
                    {% if item.image_url %}
                    <img src="{{ item.image_url }}" alt="{{ item.title }}" class="card-img" onload="checkImg(this)" onerror="swapPh(this)">
                    {% endif %}
                    <div class="card-placeholder {{ item.platform }}" {% if item.image_url %}style="display:none"{% endif %}>
                        {% if item.platform == 'youtube' %}
                            <i class="fab fa-youtube"></i>
                            <span>YouTube</span>
                        {% elif item.platform == 'instagram' %}
                            <i class="fab fa-instagram"></i>
                            <span>Instagram</span>
                        {% elif item.platform == 'twitter' %}
                            <i class="fab fa-twitter"></i>
                            <span>Twitter</span>
                        {% elif item.platform == 'tiktok' %}
                            <i class="fab fa-tiktok"></i>
                            <span>TikTok</span>
                        {% elif item.platform == 'facebook' %}
                            <i class="fab fa-facebook"></i>
                            <span>Facebook</span>
                        {% elif item.platform == 'linkedin' %}
                            <i class="fab fa-linkedin"></i>
                            <span>LinkedIn</span>
                        {% elif item.platform == 'reddit' %}
                            <i class="fab fa-reddit"></i>
                            <span>Reddit</span>
                        {% elif item.platform == 'pinterest' %}
                            <i class="fab fa-pinterest"></i>
                            <span>Pinterest</span>
                        {% else %}
                            <i class="fas fa-globe"></i>
                            <span>Web</span>
                        {% endif %}
                    </div>
                    <span class="badge"><i class="fas fa-{{ item.platform }}"></i> {{ item.platform }}</span>
                </div>
                <div class="card-body">
                    <div class="card-title">{{ item.title or 'Untitled' }}</div>
                    <p class="card-caption">{{ item.summary or item.caption or 'No description' }}</p>
                    {% if item.category %}<span class="card-category">{{ item.category }}</span>{% endif %}
                    <div class="card-footer">
                        <span><i class="far fa-clock"></i> {{ item.timestamp[:10] }}</span>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>

        {% if total_pages > 1 %}
        <div class="pagination">
            {% if current_page > 1 %}
            <a href="?page={{ current_page-1 }}&platform={{ selected_platform }}&category={{ selected_category }}&q={{ search_query }}"><i class="fas fa-chevron-left"></i></a>
            {% endif %}
            {% for p in range(1, total_pages+1) %}
                {% if p == current_page %}
                <span class="current">{{ p }}</span>
                {% elif p<=3 or p>=total_pages-2 or (p>=current_page-1 and p<=current_page+1) %}
                <a href="?page={{ p }}&platform={{ selected_platform }}&category={{ selected_category }}&q={{ search_query }}">{{ p }}</a>
                {% elif p==4 or p==total_pages-3 %}
                <span>…</span>
                {% endif %}
            {% endfor %}
            {% if current_page < total_pages %}
            <a href="?page={{ current_page+1 }}&platform={{ selected_platform }}&category={{ selected_category }}&q={{ search_query }}"><i class="fas fa-chevron-right"></i></a>
            {% endif %}
        </div>
        {% endif %}

        {% else %}
        <div class="empty">
            <div class="empty-icon"><i class="fas fa-search"></i></div>
            <h2>No content found</h2>
            <p>Try adjusting your filters or save more content</p>
        </div>
        {% endif %}
    </div>

    <script>
function filterAll() { window.location.href = '{{ url_for("discover") }}'; }
function filterPlatform(p) { window.location.href = '{{ url_for("discover") }}?platform=' + p; }
function checkImg(img) { setTimeout(() => { if (img.naturalWidth <= 120 && img.naturalHeight <= 90) swapPh(img); }, 50); }
function swapPh(img) {
    img.style.display = 'none';
    const p = img.nextElementSibling;
    if (p && p.classList.contains('card-placeholder')) p.style.display = 'flex';
}
    </script>
</body>
</html>
